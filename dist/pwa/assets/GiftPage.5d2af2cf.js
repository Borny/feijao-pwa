import{aP as d,aQ as E,al as A,d as S,an as w,r as u,o as B,ar as f,as as s,at as c,j as o,aC as n,aL as N,aM as L,F as V,aG as b,aA as C,aB as p,ay as m,au as $,aF as I,E as Q,y as F,H as q,az as K,aT as U,aU as P}from"./index.3e321f06.js";import{Q as H}from"./QPage.e73079a9.js";import{C as M}from"./ClosePopup.d337e6bb.js";import{u as Y}from"./use-quasar.7b1fc602.js";import{u as j}from"./vue-i18n.a2532de4.js";import{u as R}from"./app.504a9c26.js";var z={isAuthenticated:e=>!!e.token,getToken:e=>e.token},J={async getGiftById(e){const a=await d.get(`/gift/${e}`);if(!a)return"No gifts found";if(a.status===200)return a.data},async getGifts(){const e=await d.get("/gift");if(!e)return"No gift found";if(e.status===200)return e.data},async createGift(e){const a=await d.post("/gift",e);if(!a)return"Gift creation failed";if(a.status===201)return a.data},async updateGift(e,a){const r=await d.patch(`/gift/${e.id}`,{...e,userId:a});if(!r)return"Gift update failed";if(r.status===200)return r.data},async deleteGift(e){const a=await d.delete(`/gift/${e}`);if(!a)return"Gift delete failed";if(a.status===200)return a.data}};const W=E("gift",{state:()=>({info:null}),getters:z,actions:J});const X=S({name:"IndexPage",setup(){const e=Y(),a=R(),r=w(),_=j(),y=W(),v=u([]),t=u(null),l=u(!1),g=u(!1),G=u(!1),h=u(null);function D(){a.$patch({appTitle:"Gift"}),h.value=r.getUserInfo,k()}B(async()=>{D()});async function k(){l.value=!0;try{const i=await y.getGifts();v.value=i}catch(i){console.log("Failed to get data",i)}finally{l.value=!1}}async function O(){l.value=!0,g.value=!1;try{t.value.user_id=t.value.user_id?null:h.value.id,t.value.state=t.value.state==="free"?"booked":"free",await y.updateGift(t.value)&&(e.notify({type:"positive",message:`${t.value.state!=="free"?`${_.t("GIFT_BOOKED")}`:`${_.t("BOOKING_CANCELLED")}`}`}),t.value.state!=="free"&&(G.value=!0,setTimeout(()=>{G.value=!1},3e3)))}catch{e.notify({type:"negative",message:`${_.t("FAILED_TO_BOOK_THE_GIFT")}`}),console.log("failed to create gifts")}finally{t.value=null,k(),l.value=!0}}async function T(i){t.value=i,g.value=!0}return{onOpenGiftDialog:T,getGifts:k,submit:O,loadingGifts:l,displayGiftDialog:g,displayThanksDialog:G,selectedGift:t,gifts:v,user:h}}}),Z=e=>(U("data-v-686074ff"),e=e(),P(),e),x={class:"column"},ee={class:"column"},te=["src"],ae={class:"text-h4 text-center font-caveat text-bold text-primary"},se={class:"q-mt-lg text-accent"},oe={class:"q-mt-lg text-accent font-caveat text-h3"},le={class:"q-mt-lg text-accent"},ne=Z(()=>n("p",{class:"q-ml-sm text-accent"},"Muito obrigado !",-1));function ie(e,a,r,_,y,v){return c(),f(H,{class:"page"},{default:s(()=>[o(F,null,{default:s(()=>[n("div",x,[n("div",ee,[(c(!0),N(V,null,L(e.gifts,(t,l)=>(c(),f(C,{flat:"",key:l,class:"col-1-md card bg-primary padding-none"},{default:s(()=>[o(p,{class:"q-pt-md q-pb-xl bg-white"},{default:s(()=>[n("img",{src:`./src/assets/pictures/${t.picture_url}`},null,8,te),n("div",ae,m(t.title),1)]),_:2},1024),o(I,{class:"card__action",align:"center"},{default:s(()=>[o($,{color:t.state==="free"?"accent":"info","text-color":"primary",label:t.state==="free"?e.$t("ILL_TAKE_CARE_OF_IT"):e.$t("ALREADY_BOOKED"),disable:t.state==="booked"&&t.user_id!==e.user.id,onClick:g=>e.onOpenGiftDialog(t)},{default:s(()=>[t.state==="booked"&&t.user_id===e.user.id?(c(),f(q,{key:0,right:"",name:"edit"})):K("",!0)]),_:2},1032,["color","label","disable","onClick"])]),_:2},1024)]),_:2},1024))),128))]),o(b,{modelValue:e.displayGiftDialog,"onUpdate:modelValue":a[0]||(a[0]=t=>e.displayGiftDialog=t),class:"dialog--gift"},{default:s(()=>[o(C,{class:"bg-secondary"},{default:s(()=>{var t;return[((t=e.selectedGift)==null?void 0:t.state)==="free"?(c(),f(p,{key:0,class:"column items-center"},{default:s(()=>{var l;return[n("p",se,m(e.$t("YOUVE_CHOSEN")),1),n("p",oe,m((l=e.selectedGift)==null?void 0:l.title),1)]}),_:1})):(c(),f(p,{key:1,class:"column items-center"},{default:s(()=>[n("p",le,m(e.$t("DID_YOU_CHANGE_YOUR_MIND")),1)]),_:1})),o(p,{class:"row justify-center"},{default:s(()=>[o($,{color:"accent",label:e.selectedGift.state==="free"?e.$t("VALIDATE"):e.$t("CANCEL_BOOKING"),onClick:e.submit},null,8,["label","onClick"])]),_:1}),o(I,{align:"center"},{default:s(()=>[Q(o($,{flat:"",size:"sm",label:e.$t("BACK_TO_THE_LIST"),color:"accent"},null,8,["label"]),[[M]])]),_:1})]}),_:1})]),_:1},8,["modelValue"]),o(b,{modelValue:e.displayThanksDialog,"onUpdate:modelValue":a[1]||(a[1]=t=>e.displayThanksDialog=t),class:"dialog--thanks"},{default:s(()=>[o(C,{class:"bg-secondary"},{default:s(()=>[o(p,{class:"row justify-center"},{default:s(()=>[ne]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1})}var _e=A(X,[["render",ie],["__scopeId","data-v-686074ff"]]);export{_e as default};
