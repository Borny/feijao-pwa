import{Q as F}from"./QSpinnerTail.adeafcd3.js";import{c as S,k as x,r,w as ee,x as H,h as C,y as Y,l as te,aR as ne,aP as q,aQ as ae,d as W,an as G,o as J,al as K,at as v,ar as B,as as m,j as l,aC as y,ay as D,av as Q,aB as z,au as M,az as h,aA as R,aF as oe,E as V,aG as le,aS as ie,aq as se,aL as $,ax as j,F as re,aM as ue,aD as ce,aT as me,aU as de}from"./index.c897d222.js";import{Q as fe}from"./QPage.b2a39ffd.js";import{u as ge}from"./use-quasar.5cfbc034.js";import{u as ve}from"./vue-i18n.192b1502.js";import{u as ye}from"./picture.fab94a62.js";import{u as pe}from"./app.811f0449.js";import{C as U}from"./ClosePopup.0b9e8d7f.js";const Ce={ratio:[String,Number]};function _e(e,t){return S(()=>{const c=Number(e.ratio||(t!==void 0?t.value:void 0));return isNaN(c)!==!0&&c>0?{paddingBottom:`${100/c}%`}:null})}const he=16/9;var Se=x({name:"QImg",props:{...Ce,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:he},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:t,emit:c}){const p=r(e.initialRatio),f=_e(e,p);let a=null,o=!1;const i=[r(null),r(_())],s=r(0),d=r(!1),g=r(!1),b=S(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),w=S(()=>({width:e.width,height:e.height})),P=S(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),L=S(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));ee(()=>E(),k);function E(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function _(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function k(n){a!==null&&(clearTimeout(a),a=null),g.value=!1,n===null?(d.value=!1,i[s.value^1].value=_()):d.value=!0,i[s.value].value=n}function O({target:n}){o!==!0&&(a!==null&&(clearTimeout(a),a=null),p.value=n.naturalHeight===0?.5:n.naturalWidth/n.naturalHeight,u(n,1))}function u(n,I){o===!0||I===1e3||(n.complete===!0?T(n):a=setTimeout(()=>{a=null,u(n,I+1)},50))}function T(n){o!==!0&&(s.value=s.value^1,i[s.value].value=null,d.value=!1,g.value=!1,c("load",n.currentSrc||n.src))}function X(n){a!==null&&(clearTimeout(a),a=null),d.value=!1,g.value=!0,i[s.value].value=null,i[s.value^1].value=_(),c("error",n)}function A(n){const I=i[n].value,N={key:"img_"+n,class:P.value,style:L.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...I};return s.value===n?(N.class+=" q-img__image--waiting",Object.assign(N,{onLoad:O,onError:X})):N.class+=" q-img__image--loaded",C("div",{class:"q-img__container absolute-full",key:"img"+n},C("img",N))}function Z(){return d.value!==!0?C("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},te(t[g.value===!0?"error":"default"])):C("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},t.loading!==void 0?t.loading():e.noSpinner===!0?void 0:[C(ne,{color:e.spinnerColor,size:e.spinnerSize})])}return k(E()),H(()=>{o=!0,a!==null&&(clearTimeout(a),a=null)}),()=>{const n=[];return f.value!==null&&n.push(C("div",{key:"filler",style:f.value})),g.value!==!0&&(i[0].value!==null&&n.push(A(0)),i[1].value!==null&&n.push(A(1))),n.push(C(Y,{name:"q-transition--fade"},Z)),C("div",{class:b.value,style:w.value,role:"img","aria-label":e.alt},n)}}}),De={isAuthenticated:e=>!!e.token,getToken:e=>e.token},Te={async getCommentsByPictureId(e){const t=await q.get(`/comment/${e}`);if(!t)return"No comments found";if(t.status===200)return t.data},async getCommentId(e){const t=await q.get(`/picture/${e}`);if(!t)return"No picture found";if(t.status===201)return t.data},async createComment(e){const t=await q.post("/comment",e);if(!t)return"Comment creation failed";if(t.status===201)return t.data},async deleteComment(e){const t=await q.delete(`/comment/${e}`);if(!t)return"Comment delete failed";if(t.status===200)return t.data}};const $e=ae("comment",{state:()=>({info:null}),getters:De,actions:Te});const be=W({name:"CommentCardComponent",props:{comment:{type:Object,required:!0}},emits:["deleteComment"],setup(e,{emit:t}){const c=G(),p=r(null),f=S(()=>e.comment.updated_at?`${new Date(e.comment.updated_at).getDate()}-${new Date(e.comment.updated_at).getMonth()}-${new Date(e.comment.updated_at).getYear()}`:null);function a(){p.value=c.user}function o(){t("deleteComment",e.comment.id)}return J(async()=>a()),{onDeleteComment:o,openDeleteCommentDialog:r(!1),user:p,formatDate:f}}}),we={class:"q-ml-sm text-info"};function Ee(e,t,c,p,f,a){return e.comment&&e.user?(v(),B(R,{key:0,class:Q(["comment row items-center q-my-sm",e.user.id===e.comment.user_id?"bg-dark":"bg-secondary"])},{default:m(()=>[l(z,{class:"col q-py-sm"},{default:m(()=>[y("p",{class:Q([e.user.id===e.comment.user_id?"text-secondary":"text-primary","text-capitalize"])},[y("small",null,D(e.user.id===e.comment.user_id?e.$t("YOU"):e.comment.name),1)],2),y("p",{class:Q(["q-ml-md",e.user.id===e.comment.user_id?"text-primary":"text-accent"])},D(e.comment.comment),3)]),_:1}),l(z,{class:"q-py-sm"},{default:m(()=>[e.user.id===e.comment.user_id?(v(),B(M,{key:0,onClick:t[0]||(t[0]=o=>e.openDeleteCommentDialog=!0),flat:"",round:"",color:"primary",icon:"delete"})):h("",!0)]),_:1}),l(le,{modelValue:e.openDeleteCommentDialog,"onUpdate:modelValue":t[1]||(t[1]=o=>e.openDeleteCommentDialog=o),class:"dialog--comment"},{default:m(()=>[l(R,null,{default:m(()=>[l(z,{class:"row items-center"},{default:m(()=>[y("p",we,D(e.$t("CONFIRM_DELETE_COMMENT")),1)]),_:1}),l(oe,{align:"right"},{default:m(()=>[V(l(M,{flat:"",label:e.$t("NO"),color:"info"},null,8,["label"]),[[U]]),V(l(M,{flat:"",label:e.$t("YES"),color:"info",onClick:e.onDeleteComment},null,8,["label","onClick"]),[[U]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["class"])):h("",!0)}var ke=K(be,[["render",Ee],["__scopeId","data-v-6b5c2d06"]]);const Ie=W({name:"PicturePage",components:{CommentCard:ke},setup(){const e=ge(),t=pe(),c=G(),p=ye(),f=$e(),a=ve(),o=r(null),i=ie(),s=r(!1),d=r(!1),g=r(null),b=r([]),w=r(!1),P=S(()=>new Date(o.value.created_at).toLocaleDateString("fr-FR",{month:"short",day:"numeric",year:"numeric"}));function L(){s.value=!0,t.$patch({appTitle:"Accueil"}),E()}J(async()=>{L()}),H(async()=>{w.value=!1});async function E(){const u=i.params.id;try{const T=await p.getPictureById(u);o.value=T.picture,_()}catch{}finally{s.value=!1}}async function _(){d.value=!0;try{const u=await f.getCommentsByPictureId(o.value.id);b.value=u}catch(u){console.log("failed to get comments",u)}finally{d.value=!1}}async function k(){console.log(g.value,"comment to create");try{await f.createComment({comment:g.value,pictureId:o.value.id,userId:c.user.id}),g.value=null,_(),e.notify({type:"positive",message:`${a.t("COMMENT_ADDED")}`})}catch(u){e.notify({type:"negative",message:`${a.t("FAILED_TO_ADD_COMMENT")}`}),console.log(u,"failed to create comments")}}async function O(u){d.value=!0;try{const T=await f.deleteComment(u);e.notify({type:"positive",message:`${a.t("COMMENT_DELETED")}`}),_()}catch{e.notify({type:"negative",message:`${a.t("FAILED_TO_DELETE_COMMENT")}`}),console.log("failed to delete comment ")}finally{d.value=!1}}return{createComment:k,deleteComment:O,picture:o,isLoading:s,loadingComments:d,commentToCreate:g,comments:b,displayPage:w,formatDate:P}}}),Ne=e=>(me("data-v-3d5c77b0"),e=e(),de(),e),qe={key:0,class:"row justify-center"},Me={key:0,class:"container"},Be={class:"image__label"},Pe=Ne(()=>y("br",null,null,-1)),Le={class:"card--comment no-wrap column"},Oe={key:0,class:"no-comment"},Qe={key:1,class:"no-comment"},ze={key:2,class:"comment__container"},Re={class:"input__container bg-primary row justify-center"};function Ae(e,t,c,p,f,a){const o=se("comment-card");return v(),B(fe,{class:"page bg-primary"},{default:m(()=>[e.isLoading?(v(),$("div",qe,[l(F,{color:"accent",size:"2em"})])):h("",!0),l(Y,null,{default:m(()=>[!e.isLoading&&e.picture?(v(),$("div",Me,[l(R,{class:"card--picture"},{default:m(()=>[l(Se,{class:"image",src:`https://feijao-app.s3.eu-central-1.amazonaws.com/${e.picture.url}`},{default:m(()=>[y("div",Be,[j(D(e.picture.location)+" ",1),Pe,j(" "+D(e.formatDate),1)])]),_:1},8,["src"])]),_:1}),y("div",Le,[e.loadingComments?(v(),$("div",Oe,[l(F,{color:"accent",size:"2em"})])):h("",!0),!e.comments.length&&!e.loadingComments?(v(),$("div",Qe,[y("p",null,D(e.$t("NO_COMMENTS_YET")),1),y("p",null,D(e.$t("BE_THE_FIRST")),1)])):h("",!0),e.comments.length&&!e.loadingComments?(v(),$("div",ze,[(v(!0),$(re,null,ue(e.comments,(i,s)=>(v(),B(o,{key:s,comment:i,onDeleteComment:e.deleteComment},null,8,["comment","onDeleteComment"]))),128))])):h("",!0),y("div",Re,[l(ce,{onSubmit:e.createComment,rounded:"",standout:"","bg-color":"accent",modelValue:e.commentToCreate,"onUpdate:modelValue":t[0]||(t[0]=i=>e.commentToCreate=i),modelModifiers:{trim:!0},placeholder:e.$t("WHICH_TITLE_WOULD_BE_BEST"),class:"input__comment"},{append:m(()=>[l(M,{onClick:e.createComment,type:"button",color:"primary",disabled:!e.commentToCreate||e.isLoading,round:"",dense:"",flat:"",icon:"send"},null,8,["onClick","disabled"])]),_:1},8,["onSubmit","modelValue","placeholder"])])])])):h("",!0)]),_:1})]),_:1})}var Je=K(Ie,[["render",Ae],["__scopeId","data-v-3d5c77b0"]]);export{Je as default};
