import{S as te,U as O,a as h,V as ae,b as oe,h as M,j as se,c as le,az as V,aA as ne,ab as Y,ad as K,o as W,aa as X,ai as v,ag as w,ah as i,aj as o,as as l,ao as C,al as N,an as Q,aw as q,ak as S,ap as k,av as L,aE as Z,aF as G,r as b,af as re,ar as I,at as ie,au as ue,aD as de,aL as ce,aM as z,aH as F,aC as pe,Z as H,T as fe}from"./index.886762cb.js";import{Q as ge}from"./QSpinnerTail.7b4804c4.js";import{Q as me}from"./QPage.c510108b.js";import{C as R}from"./ClosePopup.0b78a89f.js";import{u as be}from"./use-quasar.0e1b00a7.js";import{u as ve}from"./app.b9f1ac3e.js";const ye={position:{type:String,default:"bottom-right",validator:e=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(e)},offset:{type:Array,validator:e=>e.length===2},expand:Boolean};function he(){const{props:e,proxy:{$q:t}}=se(),r=te(ae,O);if(r===O)return console.error("QPageSticky needs to be child of QLayout"),O;const f=h(()=>{const s=e.position;return{top:s.indexOf("top")>-1,right:s.indexOf("right")>-1,bottom:s.indexOf("bottom")>-1,left:s.indexOf("left")>-1,vertical:s==="top"||s==="bottom",horizontal:s==="left"||s==="right"}}),g=h(()=>r.header.offset),u=h(()=>r.right.offset),d=h(()=>r.footer.offset),a=h(()=>r.left.offset),_=h(()=>{let s=0,c=0;const p=f.value,B=t.lang.rtl===!0?-1:1;p.top===!0&&g.value!==0?c=`${g.value}px`:p.bottom===!0&&d.value!==0&&(c=`${-d.value}px`),p.left===!0&&a.value!==0?s=`${B*a.value}px`:p.right===!0&&u.value!==0&&(s=`${-B*u.value}px`);const y={transform:`translate(${s}, ${c})`};return e.offset&&(y.margin=`${e.offset[1]}px ${e.offset[0]}px`),p.vertical===!0?(a.value!==0&&(y[t.lang.rtl===!0?"right":"left"]=`${a.value}px`),u.value!==0&&(y[t.lang.rtl===!0?"left":"right"]=`${u.value}px`)):p.horizontal===!0&&(g.value!==0&&(y.top=`${g.value}px`),d.value!==0&&(y.bottom=`${d.value}px`)),y}),P=h(()=>`q-page-sticky row flex-center fixed-${e.position} q-page-sticky--${e.expand===!0?"expand":"shrink"}`);function $(s){const c=oe(s.default);return M("div",{class:P.value,style:_.value},e.expand===!0?c:[M("div",c)])}return{$layout:r,getStickyContent:$}}var Be=le({name:"QPageSticky",props:ye,setup(e,{slots:t}){const{getStickyContent:r}=he();return()=>r(t)}}),ke={isAuthenticated:e=>!!e.token,getToken:e=>e.token},_e={async getBetById(e){const t=await V.get(`/bet/${e}`);if(!t)return"No bets found";if(t.status===200)return t.data},async getBets(){const e=await V.get("/bet");if(!e)return"No bet found";if(console.log("get bets response",e.data),e.status===200)return e.data},async createBet(e){console.log("this.createBet",e);const t=await V.post("/bet",e);if(!t)return"Bet creation failed";if(t.status===201)return t.data},async updateBet(e){console.log("store update bet",e);const t=await V.patch(`/bet/${e.id}`,e);if(!t)return"Bet update failed";if(console.log("store update bet response",t),t.status===200)return t.data},async deleteBet(e){console.log("this.delete bet ",e);const t=await V.delete(`/bet/${e}`);if(!t)return"Bet delete failed";if(t.status===200)return t.data}};const $e=ne("bet",{state:()=>({info:null}),getters:ke,actions:_e});const Ce=Y({name:"BetCardComponent",props:{bet:{type:Object,required:!0},user:{type:Object,required:!0}},emits:["udpateBet"],setup(e,{emit:t}){K();function r(){}function f(){console.log("udpate bet",e.bet),t("udpateBet",{mode:"update",bet:e.bet})}return W(async()=>void 0),{onUpdateBet:f}}}),we=e=>(Z("data-v-4886e89a"),e=e(),G(),e),Ve={class:"text-capitalize"},Se=we(()=>l("br",null,null,-1));function Qe(e,t,r,f,g,u){return e.bet&&e.user?(v(),w(L,{key:0,class:N(["bet row items-center q-my-sm",e.user.id===e.bet.user_id?"bg-dark":"bg-secondary"])},{default:i(()=>[o(q,{class:"col q-py-sm"},{default:i(()=>[l("p",{class:N(e.user.id===e.bet.user_id?"text-secondary":"text-dark")},[l("small",null,C(e.user.id===e.bet.user_id?"You":e.bet.name),1)],2),l("p",{class:N(["q-ml-md text-center",e.user.id===e.bet.user_id?"text-primary":"text-accent"])},[l("span",Ve,C(e.bet.gender),1),Q(" - "+C(e.bet.height)+" - "+C(e.bet.weight)+" ",1),Se,Q(" "+C(e.bet.extra),1)],2)]),_:1}),o(q,{class:"q-py-sm"},{default:i(()=>[e.user.id===e.bet.user_id?(v(),w(S,{key:0,onClick:e.onUpdateBet,flat:"",round:"",color:"primary",icon:"edit"},null,8,["onClick"])):k("",!0)]),_:1})]),_:1},8,["class"])):k("",!0)}var qe=X(Ce,[["render",Qe],["__scopeId","data-v-4886e89a"]]);const De=Y({name:"IndexPage",components:{BetCard:qe},setup(){const e=be(),t=ve(),r=K(),f=$e(),g=b([]),u=b(!1),d=b(!1),a=b(!1),_=b(null),P=h(()=>a.value?"Create":"Update"),$=b(null),s=b(null),c=b(null),p=b(null),B=b(null);function y(){t.$patch({appTitle:"Bet"}),_.value=r.getUserInfo,D()}W(async()=>{y()});async function D(){u.value=!0;try{const n=await f.getBets();g.value=n;const m=g.value.map(U=>U.user_id);a.value=!m.includes(r.user.id)}catch(n){console.log("Failed to get data",n)}finally{u.value=!1}}async function J(){try{await f.deleteBet(B.value)&&e.notify({type:"positive",message:"Bet deleted !"})}catch{response&&e.notify({type:"negative",message:"Failed to delete bet..."})}finally{D(),d.value=!1}}async function x(){u.value=!0,console.log("submit",$.value,s.value,c.value,p.value,B.value);const n={gender:$.value,height:s.value,weight:c.value,extra:p.value,userId:r.user.id,id:B.value};try{let m;a.value?(m=await f.createBet(n),m&&e.notify({type:"positive",message:"Bet added !"})):(m=await f.updateBet(n),m&&e.notify({type:"positive",message:"Bet updated !"})),D()}catch{e.notify({type:"negative",message:"Failed to add bet !"}),console.log("failed to create bets")}finally{}}async function ee(n){var m,U,A,T,E;console.log("onOpenBetDialog",n.bet,n.mode),$.value=((m=n.bet)==null?void 0:m.gender)||null,s.value=((U=n.bet)==null?void 0:U.height)||null,c.value=((A=n.bet)==null?void 0:A.weight)||null,p.value=((T=n.bet)==null?void 0:T.extra)||null,B.value=((E=n.bet)==null?void 0:E.id)||null,d.value=!d.value}return{onOpenBetDialog:ee,getBets:D,submit:x,bets:g,user:_,loadingBets:u,deleteBet:J,displayBetDialog:d,displayCreateBetBtn:a,getDialogLabel:P,gender:$,height:s,weight:c,extra:p}}}),j=e=>(Z("data-v-ee685d96"),e=e(),G(),e),Ue={class:"column"},Ie={class:"column items-center"},Pe=j(()=>l("p",{class:"text-center"},[Q(" Les paris sont ouverts !!!! "),l("br"),Q(" Vous pourrez les changer \xE0 tout moment. "),l("br"),Q(" Et nous, on pr\xE9pare une petite surprise pour le/la gagnant/e. ")],-1)),Oe={class:"card--bet no-wrap column"},Ne={key:0,class:"no-bet"},ze={key:1,class:"no-bet"},Fe=j(()=>l("p",null,"No bets yet...",-1)),Le=j(()=>l("p",null,"Be the first !",-1)),je=[Fe,Le],Ae={key:2,class:"bet__container"},Te={class:"q-ml-sm text-accent"},Ee={class:"q-gutter-sm"};function Me(e,t,r,f,g,u){const d=re("bet-card");return v(),w(me,{class:"page"},{default:i(()=>[o(fe,null,{default:i(()=>[l("div",Ue,[l("div",Ie,[o(L,{class:"col-1-md card bg-grey-lighter padding-none"},{default:i(()=>[o(q,{class:"bg-accent"},{default:i(()=>[Pe]),_:1})]),_:1}),l("div",Oe,[e.loadingBets?(v(),I("div",Ne,[o(ge,{color:"accent",size:"2em"})])):k("",!0),!e.bets.length&&!e.loadingBets?(v(),I("div",ze,je)):k("",!0),e.bets.length&&!e.loadingBets?(v(),I("div",Ae,[(v(!0),I(ie,null,ue(e.bets,(a,_)=>(v(),w(d,{key:_,bet:a,user:e.user,onUdpateBet:e.onOpenBetDialog},null,8,["bet","user","onUdpateBet"]))),128))])):k("",!0)])]),o(de,{modelValue:e.displayBetDialog,"onUpdate:modelValue":t[7]||(t[7]=a=>e.displayBetDialog=a),class:"dialog--bet"},{default:i(()=>[o(L,{class:"bg-secondary"},{default:i(()=>[o(q,{class:"row justify-center"},{default:i(()=>[l("p",Te,C(e.getDialogLabel)+" your bet",1)]),_:1}),o(q,{class:""},{default:i(()=>[l("form",{onSubmit:t[6]||(t[6]=ce((...a)=>e.submit&&e.submit(...a),["prevent"]))},[l("div",Ee,[o(z,{modelValue:e.gender,"onUpdate:modelValue":t[0]||(t[0]=a=>e.gender=a),color:"accent","checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"male",label:"Male"},null,8,["modelValue"]),o(z,{modelValue:e.gender,"onUpdate:modelValue":t[1]||(t[1]=a=>e.gender=a),color:"accent","checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"female",label:"Female"},null,8,["modelValue"]),o(z,{modelValue:e.gender,"onUpdate:modelValue":t[2]||(t[2]=a=>e.gender=a),color:"accent","checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"other",label:"Other"},null,8,["modelValue"])]),o(F,{modelValue:e.height,"onUpdate:modelValue":t[3]||(t[3]=a=>e.height=a),rounded:"",standout:"","bg-color":"accent",placeholder:"Height",class:"input__bet q-my-sm"},null,8,["modelValue"]),o(F,{modelValue:e.weight,"onUpdate:modelValue":t[4]||(t[4]=a=>e.weight=a),rounded:"",standout:"","bg-color":"accent",placeholder:"Weight",class:"input__bet q-my-sm"},null,8,["modelValue"]),o(F,{modelValue:e.extra,"onUpdate:modelValue":t[5]||(t[5]=a=>e.extra=a),rounded:"",standout:"","bg-color":"accent",placeholder:"Extra",class:"input__bet q-my-sm"},null,8,["modelValue"])],32)]),_:1}),o(pe,{align:"between"},{default:i(()=>[l("div",null,[e.displayCreateBetBtn?k("",!0):(v(),w(S,{key:0,label:"Delete",color:"info",onClick:e.deleteBet},null,8,["onClick"]))]),l("div",null,[H(o(S,{flat:"",label:"Nope",color:"accent"},null,512),[[R]]),H(o(S,{label:"Let's roll!",color:"accent",onClick:e.submit,disable:!e.gender||!e.height||!e.weight},null,8,["onClick","disable"]),[[R]])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e.displayCreateBetBtn?(v(),w(Be,{key:0,position:"bottom-right",offset:[20,20]},{default:i(()=>[o(S,{label:"Place a bet",rounded:"",color:"accent",onClick:t[8]||(t[8]=a=>e.onOpenBetDialog({mode:"create"}))})]),_:1})):k("",!0)])]),_:1})]),_:1})}var Ze=X(De,[["render",Me],["__scopeId","data-v-ee685d96"]]);export{Ze as default};
