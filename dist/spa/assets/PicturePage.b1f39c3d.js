import{Q as F}from"./QSpinnerTail.90e46a57.js";import{c as S,k as x,r,w as ee,x as U,h as C,y as Y,l as te,aQ as ne,aO as q,aP as ae,d as W,an as K,o as G,al as J,as as g,aq as M,ar as m,j as i,aA as v,ax as D,au as Q,az as z,at as B,aF as h,ay as R,aD as oe,E as V,aE as ie,aR as le,ap as se,aK as $,aw as j,F as re,aL as ue,aB as ce,aS as me,aT as de}from"./index.44f6ce53.js";import{Q as fe}from"./QPage.5bc6551c.js";import{u as ge}from"./use-quasar.14d0d952.js";import{u as ve}from"./vue-i18n.ecbb3cba.js";import{u as ye}from"./picture.1ce2ddd6.js";import{u as pe}from"./app.0ca77772.js";import{C as H}from"./ClosePopup.127b782c.js";const Ce={ratio:[String,Number]};function _e(e,t){return S(()=>{const c=Number(e.ratio||(t!==void 0?t.value:void 0));return isNaN(c)!==!0&&c>0?{paddingBottom:`${100/c}%`}:null})}const he=16/9;var Se=x({name:"QImg",props:{...Ce,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:he},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:t,emit:c}){const y=r(e.initialRatio),f=_e(e,y);let a=null,o=!1;const l=[r(null),r(_())],s=r(0),d=r(!1),p=r(!1),b=S(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),w=S(()=>({width:e.width,height:e.height})),O=S(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),P=S(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));ee(()=>E(),k);function E(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function _(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function k(n){a!==null&&(clearTimeout(a),a=null),p.value=!1,n===null?(d.value=!1,l[s.value^1].value=_()):d.value=!0,l[s.value].value=n}function L({target:n}){o!==!0&&(a!==null&&(clearTimeout(a),a=null),y.value=n.naturalHeight===0?.5:n.naturalWidth/n.naturalHeight,u(n,1))}function u(n,I){o===!0||I===1e3||(n.complete===!0?T(n):a=setTimeout(()=>{a=null,u(n,I+1)},50))}function T(n){o!==!0&&(s.value=s.value^1,l[s.value].value=null,d.value=!1,p.value=!1,c("load",n.currentSrc||n.src))}function X(n){a!==null&&(clearTimeout(a),a=null),d.value=!1,p.value=!0,l[s.value].value=null,l[s.value^1].value=_(),c("error",n)}function A(n){const I=l[n].value,N={key:"img_"+n,class:O.value,style:P.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...I};return s.value===n?(N.class+=" q-img__image--waiting",Object.assign(N,{onLoad:L,onError:X})):N.class+=" q-img__image--loaded",C("div",{class:"q-img__container absolute-full",key:"img"+n},C("img",N))}function Z(){return d.value!==!0?C("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},te(t[p.value===!0?"error":"default"])):C("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},t.loading!==void 0?t.loading():e.noSpinner===!0?void 0:[C(ne,{color:e.spinnerColor,size:e.spinnerSize})])}return k(E()),U(()=>{o=!0,a!==null&&(clearTimeout(a),a=null)}),()=>{const n=[];return f.value!==null&&n.push(C("div",{key:"filler",style:f.value})),p.value!==!0&&(l[0].value!==null&&n.push(A(0)),l[1].value!==null&&n.push(A(1))),n.push(C(Y,{name:"q-transition--fade"},Z)),C("div",{class:b.value,style:w.value,role:"img","aria-label":e.alt},n)}}}),De={isAuthenticated:e=>!!e.token,getToken:e=>e.token},Te={async getCommentsByPictureId(e){const t=await q.get(`/comment/${e}`);if(!t)return"No comments found";if(t.status===200)return t.data},async getCommentId(e){const t=await q.get(`/picture/${e}`);if(!t)return"No picture found";if(t.status===201)return t.data},async createComment(e){const t=await q.post("/comment",e);if(!t)return"Comment creation failed";if(t.status===201)return t.data},async deleteComment(e){const t=await q.delete(`/comment/${e}`);if(!t)return"Comment delete failed";if(t.status===200)return t.data}};const $e=ae("comment",{state:()=>({info:null}),getters:De,actions:Te});const be=W({name:"CommentCardComponent",props:{comment:{type:Object,required:!0}},emits:["deleteComment"],setup(e,{emit:t}){const c=K(),y=r(null),f=S(()=>e.comment.updated_at?`${new Date(e.comment.updated_at).getDate()}-${new Date(e.comment.updated_at).getMonth()}-${new Date(e.comment.updated_at).getYear()}`:null);function a(){y.value=c.user}function o(){t("deleteComment",e.comment.id)}return G(async()=>a()),{onDeleteComment:o,openDeleteCommentDialog:r(!1),user:y,formatDate:f}}}),we={class:"q-ml-sm text-info"};function Ee(e,t,c,y,f,a){return e.comment&&e.user?(g(),M(R,{key:0,class:Q(["comment row items-center q-my-sm",e.user.id===e.comment.user_id?"bg-dark":"bg-secondary"])},{default:m(()=>[i(z,{class:"col q-py-sm"},{default:m(()=>[v("p",{class:Q([e.user.id===e.comment.user_id?"text-secondary":"text-primary","text-capitalize"])},[v("small",null,D(e.user.id===e.comment.user_id?e.$t("YOU"):e.comment.name),1)],2),v("p",{class:Q(["q-ml-md",e.user.id===e.comment.user_id?"text-primary":"text-accent"])},D(e.comment.comment),3)]),_:1}),i(z,{class:"q-py-sm"},{default:m(()=>[e.user.id===e.comment.user_id?(g(),M(B,{key:0,onClick:t[0]||(t[0]=o=>e.openDeleteCommentDialog=!0),flat:"",round:"",color:"primary",icon:"delete"})):h("",!0)]),_:1}),i(ie,{modelValue:e.openDeleteCommentDialog,"onUpdate:modelValue":t[1]||(t[1]=o=>e.openDeleteCommentDialog=o),class:"dialog--comment"},{default:m(()=>[i(R,null,{default:m(()=>[i(z,{class:"row items-center"},{default:m(()=>[v("p",we,D(e.$t("CONFIRM_DELETE_COMMENT")),1)]),_:1}),i(oe,{align:"right"},{default:m(()=>[V(i(B,{flat:"",label:e.$t("NO"),color:"info"},null,8,["label"]),[[H]]),V(i(B,{flat:"",label:e.$t("YES"),color:"info",onClick:e.onDeleteComment},null,8,["label","onClick"]),[[H]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["class"])):h("",!0)}var ke=J(be,[["render",Ee],["__scopeId","data-v-6b5c2d06"]]);const Ie=W({name:"PicturePage",components:{CommentCard:ke},setup(){const e=ge(),t=pe(),c=K(),y=ye(),f=$e(),a=ve(),o=r(null),l=le(),s=r(!1),d=r(!1),p=r(null),b=r([]),w=r(!1),O=S(()=>new Date(o.value.created_at).toLocaleDateString("fr-FR",{month:"short",day:"numeric",year:"numeric"}));function P(){s.value=!0,t.$patch({appTitle:"Accueil"}),E()}G(async()=>{P()}),U(async()=>{w.value=!1});async function E(){const u=l.params.id;try{const T=await y.getPictureById(u);o.value=T.picture,_()}catch{}finally{s.value=!1}}async function _(){d.value=!0;try{const u=await f.getCommentsByPictureId(o.value.id);b.value=u}catch(u){console.log("failed to get comments",u)}finally{d.value=!1}}async function k(){try{await f.createComment({comment:p.value,pictureId:o.value.id,userId:c.user.id}),p.value=null,_(),e.notify({type:"positive",message:`${a.t("COMMENT_ADDED")}`})}catch(u){e.notify({type:"negative",message:`${a.t("FAILED_TO_ADD_COMMENT")}`}),console.log(u,"failed to create comments")}}async function L(u){d.value=!0;try{const T=await f.deleteComment(u);e.notify({type:"positive",message:`${a.t("COMMENT_DELETED")}`}),_()}catch{e.notify({type:"negative",message:`${a.t("FAILED_TO_DELETE_COMMENT")}`}),console.log("failed to delete comment ")}finally{d.value=!1}}return{createComment:k,deleteComment:L,picture:o,isLoading:s,loadingComments:d,commentToCreate:p,comments:b,displayPage:w,formatDate:O}}}),Ne=e=>(me("data-v-65d52954"),e=e(),de(),e),qe={key:0,class:"row justify-center"},Be={key:0,class:"container"},Me={class:"image__label"},Oe=Ne(()=>v("br",null,null,-1)),Pe={class:"card--comment no-wrap column"},Le={key:0,class:"no-comment"},Qe={key:1,class:"no-comment"},ze={key:2,class:"comment__container"},Re={class:"input__container bg-primary row justify-center"};function Ae(e,t,c,y,f,a){const o=se("comment-card");return g(),M(fe,{class:"page bg-primary"},{default:m(()=>[e.isLoading?(g(),$("div",qe,[i(F,{color:"accent",size:"2em"})])):h("",!0),i(Y,null,{default:m(()=>[!e.isLoading&&e.picture?(g(),$("div",Be,[i(R,{class:"card--picture"},{default:m(()=>[i(Se,{class:"image",src:`https://feijao-app.s3.eu-central-1.amazonaws.com/${e.picture.url}`},{default:m(()=>[v("div",Me,[j(D(e.picture.location)+" ",1),Oe,j(" "+D(e.formatDate),1)])]),_:1},8,["src"])]),_:1}),v("div",Pe,[e.loadingComments?(g(),$("div",Le,[i(F,{color:"accent",size:"2em"})])):h("",!0),!e.comments.length&&!e.loadingComments?(g(),$("div",Qe,[v("p",null,D(e.$t("NO_COMMENTS_YET")),1),v("p",null,D(e.$t("BE_THE_FIRST")),1)])):h("",!0),e.comments.length&&!e.loadingComments?(g(),$("div",ze,[(g(!0),$(re,null,ue(e.comments,(l,s)=>(g(),M(o,{key:s,comment:l,onDeleteComment:e.deleteComment},null,8,["comment","onDeleteComment"]))),128))])):h("",!0),v("div",Re,[i(ce,{onSubmit:e.createComment,rounded:"",standout:"","bg-color":"accent",modelValue:e.commentToCreate,"onUpdate:modelValue":t[0]||(t[0]=l=>e.commentToCreate=l),modelModifiers:{trim:!0},placeholder:e.$t("WHICH_TITLE_WOULD_BE_BEST"),class:"input__comment"},{append:m(()=>[i(B,{onClick:e.createComment,type:"button",color:"primary",disabled:!e.commentToCreate||e.isLoading,round:"",dense:"",flat:"",icon:"send"},null,8,["onClick","disabled"])]),_:1},8,["onSubmit","modelValue","placeholder"])])])])):h("",!0)]),_:1})]),_:1})}var Ge=J(Ie,[["render",Ae],["__scopeId","data-v-65d52954"]]);export{Ge as default};
