import{az as f,aA as Q,aa as T,ab as q,ad as I,r as u,o as A,ag as p,ah as s,ai as d,aj as o,as as i,ar as B,au as x,at as N,aD as w,av as G,aw as g,ao as C,ak as k,aC as D,Z as P,T as j,a0 as z,ap as F,aE as O,aF as U}from"./index.886762cb.js";import{Q as E}from"./QPage.c510108b.js";import{C as J}from"./ClosePopup.0b78a89f.js";import{u as M}from"./use-quasar.0e1b00a7.js";import{u as L}from"./app.b9f1ac3e.js";var R={isAuthenticated:e=>!!e.token,getToken:e=>e.token},Z={async getGiftById(e){const t=await f.get(`/gift/${e}`);if(!t)return"No gifts found";if(t.status===200)return t.data},async getGifts(){const e=await f.get("/gift");if(!e)return"No gift found";if(console.log("get gifts response",e.data),e.status===200)return e.data},async createGift(e){console.log("this.createGift",e);const t=await f.post("/gift",e);if(!t)return"Gift creation failed";if(t.status===201)return t.data},async updateGift(e,t){console.log("store update gift",e);const r=await f.patch(`/gift/${e.id}`,{...e,userId:t});if(!r)return"Gift update failed";if(console.log("store update gift response",r),r.status===200)return r.data},async deleteGift(e){console.log("this.delete gift ",e);const t=await f.delete(`/gift/${e}`);if(!t)return"Gift delete failed";if(t.status===200)return t.data}};const H=Q("gift",{state:()=>({info:null}),getters:R,actions:Z});const K=q({name:"IndexPage",setup(){const e=M(),t=L(),r=I(),_=H(),y=u([]),l=u(null),a=u(!1),c=u(!1),m=u(!1),v=u(null);function S(){t.$patch({appTitle:"Gift"}),v.value=r.getUserInfo,h()}A(async()=>{S()});async function h(){a.value=!0;try{const n=await _.getGifts();y.value=n}catch(n){console.log("Failed to get data",n)}finally{a.value=!1}}async function V(){a.value=!0,c.value=!1;try{console.log(v.value.id),l.value.user_id=l.value.user_id?null:v.value.id,l.value.state=l.value.state==="free"?"booked":"free",await _.updateGift(l.value)&&(e.notify({type:"positive",message:`${l.value.state!=="free"?"Gift booked":"Gift unbooked"}`}),l.value.state!=="free"&&(m.value=!0,setTimeout(()=>{m.value=!1},3e3)))}catch{e.notify({type:"negative",message:"Failed to book gift !"}),console.log("failed to create gifts")}finally{l.value=null,h(),a.value=!0}}async function $(n){console.log("onOpenGiftDialog",n),l.value=n,c.value=!c.value}return{onOpenGiftDialog:$,getGifts:h,submit:V,loadingGifts:a,displayGiftDialog:c,displayThanksDialog:m,selectedGift:l,gifts:y,user:v}}}),b=e=>(O("data-v-2a71d19e"),e=e(),U(),e),W={class:"column"},X={class:"column"},Y=["src"],ee={class:"text-h4 text-center font-caveat text-bold text-primary"},te=b(()=>i("p",{class:"q-mt-lg text-accent"},"Vous avez choisi",-1)),ae={class:"q-mt-lg text-accent font-caveat text-h3"},se=b(()=>i("p",{class:"q-mt-lg text-accent"},"Vous avez chang\xE9 d'avis ?",-1)),oe=b(()=>i("p",{class:"q-ml-sm text-accent"},"Muito obrigado !",-1));function le(e,t,r,_,y,l){return d(),p(E,{class:"page"},{default:s(()=>[o(j,null,{default:s(()=>[i("div",W,[i("div",X,[(d(!0),B(N,null,x(e.gifts,(a,c)=>(d(),p(G,{flat:"",key:c,class:"col-1-md card bg-primary padding-none"},{default:s(()=>[o(g,{class:"q-pt-md q-pb-xl bg-white"},{default:s(()=>[i("img",{src:`./src/assets/pictures/${a.picture_url}`},null,8,Y),i("div",ee,C(a.title),1)]),_:2},1024),o(D,{class:"card__action",align:"center"},{default:s(()=>[o(k,{color:a.state==="free"?"accent":"info","text-color":"primary",label:a.state==="free"?"Je m'en occupe":"D\xE9j\xE0 pris...",disable:a.state==="booked"&&a.user_id!==e.user.id,onClick:m=>e.onOpenGiftDialog(a)},{default:s(()=>[a.state==="booked"&&a.user_id===e.user.id?(d(),p(z,{key:0,right:"",name:"edit"})):F("",!0)]),_:2},1032,["color","label","disable","onClick"])]),_:2},1024)]),_:2},1024))),128))]),o(w,{modelValue:e.displayGiftDialog,"onUpdate:modelValue":t[0]||(t[0]=a=>e.displayGiftDialog=a),class:"dialog--gift"},{default:s(()=>[o(G,{class:"bg-secondary"},{default:s(()=>[e.selectedGift.state==="free"?(d(),p(g,{key:0,class:"column items-center"},{default:s(()=>[te,i("p",ae,C(e.selectedGift.title),1)]),_:1})):(d(),p(g,{key:1,class:"column items-center"},{default:s(()=>[se]),_:1})),o(g,{class:"row justify-center"},{default:s(()=>[o(k,{color:"accent",label:e.selectedGift.state==="free"?"Je confirme":"Annuler ma r\xE9servation",onClick:e.submit},null,8,["label","onClick"])]),_:1}),o(D,{align:"center"},{default:s(()=>[P(o(k,{flat:"",size:"sm",label:"Retour \xE0 la liste",color:"accent"},null,512),[[J]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(w,{modelValue:e.displayThanksDialog,"onUpdate:modelValue":t[1]||(t[1]=a=>e.displayThanksDialog=a),class:"dialog--thanks"},{default:s(()=>[o(G,{class:"bg-secondary"},{default:s(()=>[o(g,{class:"row justify-center"},{default:s(()=>[oe]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1})}var de=T(K,[["render",le],["__scopeId","data-v-2a71d19e"]]);export{de as default};
