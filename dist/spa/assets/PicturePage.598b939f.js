import{Q as M}from"./QSpinnerTail.7b4804c4.js";import{a as S,c as ne,r,w as oe,l as U,h as C,T as Y,b as ae,aB as le,az as I,aA as se,ab as W,ad as G,o as Z,aa as J,ai as g,ag as P,ah as m,aj as s,as as f,ao as N,al as j,aw as L,ak as B,ap as _,av as R,aC as ie,Z as E,aD as re,aE as K,aF as X,aG as ue,af as ce,ar as w,an as H,at as me,au as de,aH as ge}from"./index.886762cb.js";import{Q as fe}from"./QPage.c510108b.js";import{u as ve}from"./use-quasar.0e1b00a7.js";import{u as ye}from"./picture.fd7f1ffd.js";import{u as pe}from"./app.b9f1ac3e.js";import{C as O}from"./ClosePopup.0b78a89f.js";const he={ratio:[String,Number]};function Ce(e,t){return S(()=>{const u=Number(e.ratio||(t!==void 0?t.value:void 0));return isNaN(u)!==!0&&u>0?{paddingBottom:`${100/u}%`}:null})}const _e=16/9;var Se=ne({name:"QImg",props:{...he,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:_e},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:t,emit:u}){const v=r(e.initialRatio),d=Ce(e,v);let o=null,c=!1;const a=[r(null),r(k())],l=r(0),y=r(!1),h=r(!1),D=S(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),Q=S(()=>({width:e.width,height:e.height})),z=S(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),V=S(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));oe(()=>b(),$);function b(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function k(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function $(n){o!==null&&(clearTimeout(o),o=null),h.value=!1,n===null?(y.value=!1,a[l.value^1].value=k()):y.value=!0,a[l.value].value=n}function i({target:n}){c!==!0&&(o!==null&&(clearTimeout(o),o=null),v.value=n.naturalHeight===0?.5:n.naturalWidth/n.naturalHeight,p(n,1))}function p(n,q){c===!0||q===1e3||(n.complete===!0?x(n):o=setTimeout(()=>{o=null,p(n,q+1)},50))}function x(n){c!==!0&&(l.value=l.value^1,a[l.value].value=null,y.value=!1,h.value=!1,u("load",n.currentSrc||n.src))}function ee(n){o!==null&&(clearTimeout(o),o=null),y.value=!1,h.value=!0,a[l.value].value=null,a[l.value^1].value=k(),u("error",n)}function A(n){const q=a[n].value,T={key:"img_"+n,class:z.value,style:V.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...q};return l.value===n?(T.class+=" q-img__image--waiting",Object.assign(T,{onLoad:i,onError:ee})):T.class+=" q-img__image--loaded",C("div",{class:"q-img__container absolute-full",key:"img"+n},C("img",T))}function te(){return y.value!==!0?C("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},ae(t[h.value===!0?"error":"default"])):C("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},t.loading!==void 0?t.loading():e.noSpinner===!0?void 0:[C(le,{color:e.spinnerColor,size:e.spinnerSize})])}return $(b()),U(()=>{c=!0,o!==null&&(clearTimeout(o),o=null)}),()=>{const n=[];return d.value!==null&&n.push(C("div",{key:"filler",style:d.value})),h.value!==!0&&(a[0].value!==null&&n.push(A(0)),a[1].value!==null&&n.push(A(1))),n.push(C(Y,{name:"q-transition--fade"},te)),C("div",{class:D.value,style:Q.value,role:"img","aria-label":e.alt},n)}}}),be={isAuthenticated:e=>!!e.token,getToken:e=>e.token},we={async getCommentsByPictureId(e){const t=await I.get(`/comment/${e}`);if(!t)return"No comments found";if(t.status===200)return t.data},async getCommentId(e){const t=await I.get(`/picture/${e}`);if(!t)return"No picture found";if(t.status===201)return t.data},async createComment(e){console.log("this.createComment",e);const t=await I.post("/comment",e);if(!t)return"Comment creation failed";if(t.status===201)return t.data},async deleteComment(e){console.log("this.delete comment ",e);const t=await I.delete(`/comment/${e}`);if(!t)return"Comment delete failed";if(t.status===200)return t.data}};const ke=se("comment",{state:()=>({info:null}),getters:be,actions:we});const De=W({name:"CommentCardComponent",props:{comment:{type:Object,required:!0}},emits:["deleteComment"],setup(e,{emit:t}){const u=G(),v=r(null),d=S(()=>e.comment.updated_at?`${new Date(e.comment.updated_at).getDate()}-${new Date(e.comment.updated_at).getMonth()}-${new Date(e.comment.updated_at).getYear()}`:null);function o(){v.value=u.user}function c(){console.log("delete comment",e.comment.id),t("deleteComment",e.comment.id)}return Z(async()=>o()),{onDeleteComment:c,openDeleteCommentDialog:r(!1),user:v,formatDate:d}}}),$e=e=>(K("data-v-51631597"),e=e(),X(),e),qe=$e(()=>f("p",{class:"q-ml-sm text-info"},"Do you wish to delete this comment ?",-1));function Te(e,t,u,v,d,o){return e.comment&&e.user?(g(),P(R,{key:0,class:j(["comment row items-center q-my-sm",e.user.id===e.comment.user_id?"bg-dark":"bg-secondary"])},{default:m(()=>[s(L,{class:"col q-py-sm"},{default:m(()=>[f("p",{class:j(e.user.id===e.comment.user_id?"text-secondary":"text-dark")},[f("small",null,N(e.user.id===e.comment.user_id?"You":e.comment.name),1)],2),f("p",{class:j(["q-ml-md",e.user.id===e.comment.user_id?"text-primary":"text-accent"])},N(e.comment.comment),3)]),_:1}),s(L,{class:"q-py-sm"},{default:m(()=>[e.user.id===e.comment.user_id?(g(),P(B,{key:0,onClick:t[0]||(t[0]=c=>e.openDeleteCommentDialog=!0),flat:"",round:"",color:"primary",icon:"delete"})):_("",!0)]),_:1}),s(re,{modelValue:e.openDeleteCommentDialog,"onUpdate:modelValue":t[1]||(t[1]=c=>e.openDeleteCommentDialog=c),class:"dialog--comment"},{default:m(()=>[s(R,null,{default:m(()=>[s(L,{class:"row items-center"},{default:m(()=>[qe]),_:1}),s(ie,{align:"right"},{default:m(()=>[E(s(B,{flat:"",label:"Nope",color:"info"},null,512),[[O]]),E(s(B,{flat:"",label:"Yes I do!",color:"info",onClick:e.onDeleteComment},null,8,["onClick"]),[[O]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["class"])):_("",!0)}var Ie=J(De,[["render",Te],["__scopeId","data-v-51631597"]]);const Be=W({name:"PicturePage",components:{CommentCard:Ie},setup(){const e=ve(),t=pe(),u=G(),v=ye(),d=ke(),o=r(null),c=ue(),a=r(!1),l=r(!1),y=r(null),h=r([]),D=r(!1),Q=S(()=>new Date(o.value.created_at).toLocaleDateString("fr-FR",{month:"short",day:"numeric",year:"numeric"}));function z(){a.value=!0,t.$patch({appTitle:"Accueil"}),V()}Z(async()=>{console.log("mount"),z()}),U(async()=>{D.value=!1,console.log("unmount")});async function V(){const i=c.params.id;try{const p=await v.getPictureById(i);o.value=p.picture,b()}catch(p){console.log("failed to get data",p)}finally{a.value=!1}}async function b(){l.value=!0;try{const i=await d.getCommentsByPictureId(o.value.id);h.value=i}catch(i){console.log("failed to get comments",i)}finally{l.value=!1}}async function k(){try{console.log("createComment user:",u.user);const i=await d.createComment({comment:y.value,pictureId:o.value.id,userId:u.user.id});console.log(i.data),y.value=null,b(),e.notify({type:"positive",message:"Comment added !"})}catch{e.notify({type:"negative",message:"Failed to add comment !"}),console.log("failed to create comments")}}async function $(i){console.log("delete comment 02",i),l.value=!0;try{const p=await d.deleteComment(i);console.log("response delete comment",p.data),e.notify({type:"positive",message:"Comment deleted !"}),b()}catch{e.notify({type:"negative",message:"Failed to delete comment !"}),console.log("failed to delete comment ")}finally{l.value=!1}}return{createComment:k,deleteComment:$,picture:o,isLoading:a,loadingComments:l,commentToCreate:y,comments:h,displayPage:D,formatDate:Q}}}),F=e=>(K("data-v-73f0bc0e"),e=e(),X(),e),Pe={key:0,class:"row"},Ne={key:0,class:"container"},Qe={class:"image__label"},ze=F(()=>f("br",null,null,-1)),Ve={class:"card--comment no-wrap column"},je={key:0,class:"no-comment"},Le={key:1,class:"no-comment"},Re=F(()=>f("p",null,"No comments yet...",-1)),Fe=F(()=>f("p",null,"Be the first !",-1)),Ae=[Re,Fe],Me={key:2,class:"comment__container"},Ee={class:"input__container bg-primary row justify-center"};function He(e,t,u,v,d,o){const c=ce("comment-card");return g(),P(fe,{class:"page bg-primary"},{default:m(()=>[e.isLoading?(g(),w("div",Pe,[s(M,{color:"accent",size:"2em"})])):_("",!0),s(Y,null,{default:m(()=>[!e.isLoading&&e.picture?(g(),w("div",Ne,[s(R,{class:"card--picture"},{default:m(()=>[s(Se,{class:"image",src:`https://feijao-app.s3.eu-central-1.amazonaws.com/${e.picture.url}`},{default:m(()=>[f("div",Qe,[H(N(e.picture.location)+" ",1),ze,H(" "+N(e.formatDate),1)])]),_:1},8,["src"])]),_:1}),f("div",Ve,[e.loadingComments?(g(),w("div",je,[s(M,{color:"accent",size:"2em"})])):_("",!0),!e.comments.length&&!e.loadingComments?(g(),w("div",Le,Ae)):_("",!0),e.comments.length&&!e.loadingComments?(g(),w("div",Me,[(g(!0),w(me,null,de(e.comments,(a,l)=>(g(),P(c,{key:l,comment:a,onDeleteComment:e.deleteComment},null,8,["comment","onDeleteComment"]))),128))])):_("",!0),f("div",Ee,[s(ge,{onSubmit:e.createComment,rounded:"",standout:"","bg-color":"accent",modelValue:e.commentToCreate,"onUpdate:modelValue":t[0]||(t[0]=a=>e.commentToCreate=a),modelModifiers:{trim:!0},placeholder:"Which title would be best ?",class:"input__comment"},{append:m(()=>[s(B,{onClick:e.createComment,type:"button",color:"primary",disabled:!e.commentToCreate||e.isLoading,round:"",dense:"",flat:"",icon:"send"},null,8,["onClick","disabled"])]),_:1},8,["onSubmit","modelValue"])])])])):_("",!0)]),_:1})]),_:1})}var Ke=J(Be,[["render",He],["__scopeId","data-v-73f0bc0e"]]);export{Ke as default};
